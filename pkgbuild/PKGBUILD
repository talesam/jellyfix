# Maintainer: Tales A. Mendonça <talesam@gmail.com>

pkgname=jellyfix
pkgdesc="Organizador inteligente de bibliotecas Jellyfin - renomeia filmes, séries e legendas automaticamente"
pkgver=$(date +%y.%m.%d)
pkgrel=$(date +%H%M)
arch=('any')
license=('MIT')
url="https://github.com/talesam/${pkgname}"
depends=(
    'python'
    'python-rich'
    'python-requests'
    'python-questionary'
)
source=("git+${url}.git")
md5sums=('SKIP')

# Automatically detect and use the correct install file
if [ -e "${pkgname}.install" ]; then
    install=${pkgname}.install
elif [ -e "pkgbuild.install" ]; then
    install=pkgbuild.install
fi

prepare() {
    cd "${srcdir}/${pkgname}"
    # Nenhuma preparação necessária
}

build() {
    cd "${srcdir}/${pkgname}"
    # Não há compilação necessária para Python
}

check() {
    cd "${srcdir}/${pkgname}"
    # Verifica se o script principal existe e é executável
    if [ ! -f "usr/bin/jellyfix" ]; then
        echo "Erro: usr/bin/jellyfix não encontrado!"
        return 1
    fi
}

package() {
    cd "${srcdir}/${pkgname}"

    # Instala arquivos do projeto
    if [ -d "usr" ]; then
        cp -a usr "${pkgdir}/"
    fi

    # Garante permissões corretas
    chmod +x "${pkgdir}/usr/bin/jellyfix"

    # Instala licença
    if [ -f "LICENSE" ]; then
        install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
    fi

    # Instala documentação
    if [ -f "README.md" ]; then
        install -Dm644 README.md "${pkgdir}/usr/share/doc/${pkgname}/README.md"
    fi

    # Instala guia de nomenclatura
    if [ -f "jellyfin-naming-guide.md" ]; then
        install -Dm644 jellyfin-naming-guide.md "${pkgdir}/usr/share/doc/${pkgname}/jellyfin-naming-guide.md"
    fi
}
